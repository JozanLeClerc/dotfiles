#!/bin/dash

export SXHKD_SHELL=/bin/zsh
export XDG_CONFIG_HOME="${HOME}/.config"
export EDITOR="nvim"
export PATH="${HOME}/.local/bin:${PATH}"

run() {
	if ! pgrep "$1";
	then
		"$@"
	fi
}

# KILL
rm /home/jozan/.calcurse/.calcurse.pid
killall st


dualscreen
dual=$?
sleep 1s

if [ $dual -eq 0 ]; then
	bspc monitor LVDS1 -d 04 05 06 07 08 09 10
	bspc monitor VGA1 -d 01 02 03
else
	bspc monitor LVDS1 -d 01 02 03 04 05 06 07 08 09 10
fi

bspc config border_width		1
bspc config window_gap			0

bspc config split_ratio			0.50
bspc config borderless_monocle	true
bspc config gapless_monocle		true
bspc config single_monocle		true

if [ $dual -eq 0 ]; then
	bspc rule -a qutebrowser desktop=05 follow=true
	bspc rule -a Firefox desktop=05 follow=true
	bspc rule -a Wine desktop=06 state=floating
	bspc rule -a Slack desktop=10 follow=false
	bspc rule -a Zathura state=tiled
	bspc rule -a discord desktop=10
	bspc rule -a mplayer2 state=floating
	bspc rule -a Dunst layer=above
else
	bspc rule -a qutebrowser desktop=03 follow=on
	bspc rule -a Firefox desktop=03 follow=on
	bspc rule -a Wine desktop=04 state=floating
	bspc rule -a discord desktop=10
	bspc rule -a Slack desktop=10
	bspc rule -a Zathura state=tiled
	bspc rule -a mplayer2 state=floating
	bspc rule -a Dunst layer=above
fi
bspc rule -a Main state=floating

# START
run sxhkd > /dev/null 2>&1 &
run compton > /dev/null 2>&1 &
setxkbmap -layout us,fr -option grp:alt_shift_toggle > /dev/null 2>&1
if [ $dual -eq 0 ]; then
	feh --bg-tile /home/jozan/Pictures/wallpaper.png > /dev/null 2>&1
else
	feh --bg-fill /home/jozan/Pictures/wallpaper.png > /dev/null 2>&1
fi
xset r rate 200 100 > /dev/null 2>&1
run dunst > /dev/null 2>&1 &
run mpd > /dev/null 2>&1 &
run todo-git-updater.sh > /dev/null 2>&1 &
run lowbat > /dev/null 2>&1 &
#mopidy 2>&1 &

sleep 5s

#bspc desktop -f 09
#st -e neomutt &
#sleep 1s

if [ $dual -eq 0 ]; then
	bspc desktop -f 08
	st -e ncmpcpp &
	sleep 0.3s
	st -e newsboat &
	sleep 0.3s
	st -e ncpamixer &
	sleep 0.3s
	st -e calcurse &
	sleep 0.3s
	bspc node -f west
	bspc node -f west
	bspc node -z right -200 0
	bspc node -f east
	bspc node -z right -100 0
	bspc node -z top 0 -50
	bspc desktop -f 01
else
	bspc desktop -f 08
	st -e ncmpcpp &
	sleep 1s
	bspc desktop -f 07
	st -e calcurse &
	sleep 1s
	bspc desktop -f 06
	st -e newsboat &
	sleep 1s
	bspc desktop -f 05
	st -e ncpamixer &
	sleep 1s
	bspc desktop -f 02
fi

st -e zsh -c 'TERM=xterm-256color; emacs -nw' &
sleep 1s

if [ $dual -eq 0 ]; then
	bspc desktop -f 04
	st -e zsh -c 'clear; cowsay "Welcome back, partner!"; zsh -i' &
	sleep 0.3s
	st -e /home/jozan/.cargo/bin/ytop -s -b &
	sleep 0.3s
	bspc node -f west
	st -e vifm &
	sleep 0.3s
	bspc node -z right 180 0
	bspc node -z top 0 70
	bspc node -f north
else
	bspc desktop -f 01
	st -e /home/jozan/.cargo/bin/ytop -s -b &
	sleep 0.3s
	st -e zsh -c 'clear; cowsay "Welcome back, partner!"; zsh -i' &
	sleep 0.3s
	st -e vifm &
	sleep 0.3s
	bspc node -f west
	bspc node -z right -200 0
	sleep 0.3s
	bspc node -f east
	bspc node -z top 0 70
	sleep 0.3s
	bspc node -f north
fi
sleep 0.3s

if [ $dual -eq 0 ]; then
	bspc desktop -f 01
fi

if wget -q --spider https://gentoo.org/; then
	run slack &
fi
